---
- name: Create the Namespace
  community.kubernetes.k8s:
    definition:
      apiVersion: v1
      kind: Namespace
      metadata:
        name: "netobserv"
        labels:
          security.openshift.io/scc.podSecurityLabelSync: "false"
          pod-security.kubernetes.io/enforce: "baseline"
          pod-security.kubernetes.io/enforce-version: "latest"

- name: Setting Object Storage authentication
  community.kubernetes.k8s:
    definition:
      apiVersion: v1
      kind: Secret
      metadata:
        name: netobserv-loki
        namespace: "netobserv"
      stringData:
        access_key_id: "{{ netobserv_config_access_key_id | default(dnetobserv_config_access_key_id) }}"
        access_key_secret: "{{ netobserv_config_access_key_secret | default(dnetobserv_config_access_key_secret) }}"
        bucketnames: "{{ netobserv_config_bucket | default(dnetobserv_config_bucket) }}"
        endpoint: "{{ netobserv_config_endpoint | default(dnetobserv_config_endpoint) }}"
        region: "{{ netobserv_config_region | default(dnetobserv_config_region) }}"

- name: Create the NetObservability Loki Stack
  community.kubernetes.k8s:
    definition:
      apiVersion: loki.grafana.com/v1
      kind: LokiStack
      metadata:
        name: netobserv-loki
        namespace: "netobserv"
      spec:
        size: "{{ netobserv_config_loki_size | default(dnetobserv_config_loki_size) }}"
        storage:
          schemas:
            - version: v12
              effectiveDate: "{{ ansible_date_time.date }}"
          secret:
            name: netobserv-loki
            type: s3
        storageClassName: "{{ netobserv_config_storage_class | default(dnetobserv_config_storage_class) }}"
        tenants:
          mode: "openshift-network"

- name: Configuring RBACs
  community.kubernetes.k8s:
    definition: "{{ lookup('template', 'templates/rbacs.yml.j2') }}"

- name: Create the Flow Collector
  community.kubernetes.k8s:
    definition: "{{ lookup('template', 'templates/flow-collector.yml.j2') }}"
...
